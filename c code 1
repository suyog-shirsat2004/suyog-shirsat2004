-- Creating tables
CREATE TABLE Student (
        roll_no SERIAL PRIMARY KEY,
            name VARCHAR(30),
                address VARCHAR(50),
                    class VARCHAR(10)
);

CREATE TABLE Subject (
        scode VARCHAR(10) PRIMARY KEY,
            subject_name VARCHAR(20)
);

CREATE TABLE Student_Subject (
        roll_no INTEGER REFERENCES Student(roll_no),
            scode VARCHAR(10) REFERENCES Subject(scode),
                marks_scored INTEGER,
                    PRIMARY KEY (roll_no, scode)
);
\d Student;
\d Subject;
\d Student_Subject;

-- Inserting sample records
INSERT INTO Student (name, address, class) VALUES
    ('John Doe', '123 Main St', '10A'),
        ('Jane Smith', '456 Oak St', '11B'),
            ('Bob Johnson', '789 Maple St', '12C');

            INSERT INTO Subject (scode, subject_name) VALUES
                ('Math101', 'Mathematics'),
                    ('Sci201', 'Science'),
                        ('Eng301', 'English');

                        INSERT INTO Student_Subject VALUES
                            (1, 'Math101', 90),
                                (1, 'Sci201', 85),
                                    (2, 'Math101', 88),
                                        (2, 'Eng301', 95),
                                            (3, 'Sci201', 92);
                                                
                                                    select * from Student;
                                                        select * from Subject;
                                                            select * from Student_Subject;
                                                                
                                                                    -- Function to print student details by roll number
                                                                    CREATE OR REPLACE FUNCTION f11(roll_num INTEGER)
                                                                    RETURNS TABLE (roll_no INTEGER, name VARCHAR, address VARCHAR, class VARCHAR, scode VARCHAR, subject_name VARCHAR, marks_scored INTEGER) AS $$
                                                                    DECLARE
                                                                        student_record RECORD;
                                                                        BEGIN
                                                                            FOR student_record IN SELECT * FROM Student WHERE roll_no = roll_num LOOP
                                                                                    RETURN QUERY
                                                                                                SELECT
                                                                                                                student_record.roll_no,
                                                                                                                                student_record.name,
                                                                                                                                                student_record.address,
                                                                                                                                                                student_record.class,
                                                                                                                                                                                ss.scode,
                                                                                                                                                                                                s.subject_name,
                                                                                                                                                                                                                ss.marks_scored
                                                                                                                                                                                                                            FROM
                                                                                                                                                                                                                                            Student_Subject ss
                                                                                                                                                                                                                                                        JOIN
                                                                                                                                                                                                                                                                        Subject s ON ss.scode = s.scode
                                                                                                                                                                                                                                                                                    WHERE
                                                                                                                                                                                                                                                                                                    ss.roll_no = student_record.roll_no;
                                                                                                                                                                                                                                                                                                        END LOOP;
                                                                                                                                                                                                                                                                                                        END;
                                                                                                                                                                                                                                                                                                        $$ LANGUAGE plpgsql;






                                                                                                                                                                                                                                                                                                        -- Function to display details by student name
                                                                                                                                                                                                                                                                                                        CREATE OR REPLACE FUNCTION get_student_details_by_name(student_name VARCHAR)
                                                                                                                                                                                                                                                                                                        RETURNS TABLE (roll_no INTEGER, name VARCHAR, address VARCHAR, class VARCHAR, scode VARCHAR, subject_name VARCHAR, marks_scored INTEGER) AS $$
                                                                                                                                                                                                                                                                                                        DECLARE
                                                                                                                                                                                                                                                                                                            student_record RECORD;
                                                                                                                                                                                                                                                                                                            BEGIN
                                                                                                                                                                                                                                                                                                                FOR student_record IN SELECT * FROM Student WHERE name = student_name LOOP
                                                                                                                                                                                                                                                                                                                        RETURN QUERY
                                                                                                                                                                                                                                                                                                                                    SELECT
                                                                                                                                                                                                                                                                                                                                                    student_record.roll_no,
                                                                                                                                                                                                                                                                                                                                                                    student_record.name,
                                                                                                                                                                                                                                                                                                                                                                                    student_record.address,
                                                                                                                                                                                                                                                                                                                                                                                                    student_record.class,
                                                                                                                                                                                                                                                                                                                                                                                                                    ss.scode,
                                                                                                                                                                                                                                                                                                                                                                                                                                    s.subject_name,
                                                                                                                                                                                                                                                                                                                                                                                                                                                    ss.marks_scored
                                                                                                                                                                                                                                                                                                                                                                                                                                                                FROM
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Student_Subject ss
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            JOIN
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Subject s ON ss.scode = s.scode
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        WHERE
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ss.roll_no = student_record.roll_no;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            END LOOP;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            END;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            $$ LANGUAGE plpgsql;


                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            -- Stored function with cursors to display details by class
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            CREATE OR REPLACE FUNCTION get_student_details_by_class(class_name VARCHAR)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            RETURNS TABLE (roll_no INTEGER, name VARCHAR, address VARCHAR, class VARCHAR, scode VARCHAR, subject_name VARCHAR, marks_scored INTEGER) AS $$
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            DECLARE
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                student_record RECORD;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                BEGIN
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    FOR student_record IN SELECT * FROM Student WHERE class = class_name LOOP
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            RETURN QUERY
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        SELECT
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        student_record.roll_no,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        student_record.name,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        student_record.address,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        student_record.class,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ss.scode,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        s.subject_name,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ss.marks_scored
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    FROM
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Student_Subject ss
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                JOIN
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Subject s ON ss.scode = s.scode
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            WHERE
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ss.roll_no = student_record.roll_no;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                END LOOP;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                END;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                $$ LANGUAGE plpgsql;





                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                select * from f11(1);


                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                SELECT * FROM get_student_details_by_name('Jane Smith');


                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                SELECT * FROM get_student_details_by_class('10A');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    







                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    423bxq6bv 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         STDIN
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         Input for the program ( Optional )

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         Output:

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         CREATE TABLE
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         CREATE TABLE
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         CREATE TABLE
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Table "public.student"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Column  |         Type          | Collation | Nullable |                 Default                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ---------+-----------------------+-----------+----------+------------------------------------------
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 roll_no | integer               |           | not null | nextval('student_roll_no_seq'::regclass)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  name    | character varying(30) |           |          | 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   address | character varying(50) |           |          | 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    class   | character varying(10) |           |          | 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Indexes:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "student_pkey" PRIMARY KEY, btree (roll_no)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Referenced by:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            TABLE "student_subject" CONSTRAINT "student_subject_roll_no_fkey" FOREIGN KEY (roll_no) REFERENCES student(roll_no)

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Table "public.subject"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Column    |         Type          | Collation | Nullable | Default 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        --------------+-----------------------+-----------+----------+---------
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         scode        | character varying(10) |           | not null | 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          subject_name | character varying(20) |           |          | 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          Indexes:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              "subject_pkey" PRIMARY KEY, btree (scode)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              Referenced by:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  TABLE "student_subject" CONSTRAINT "student_subject_scode_fkey" FOREIGN KEY (scode) REFERENCES subject(scode)

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      Table "public.student_subject"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          Column    |         Type          | Collation | Nullable | Default 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          --------------+-----------------------+-----------+----------+---------
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           roll_no      | integer               |           | not null | 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            scode        | character varying(10) |           | not null | 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             marks_scored | integer               |           |          | 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             Indexes:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 "student_subject_pkey" PRIMARY KEY, btree (roll_no, scode)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 Foreign-key constraints:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     "student_subject_roll_no_fkey" FOREIGN KEY (roll_no) REFERENCES student(roll_no)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         "student_subject_scode_fkey" FOREIGN KEY (scode) REFERENCES subject(scode)

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         INSERT 0 3
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         INSERT 0 3
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         INSERT 0 5
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          roll_no |    name     |   address    | class 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ---------+-------------+--------------+-------
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 1 | John Doe    | 123 Main St  | 10A
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        2 | Jane Smith  | 456 Oak St   | 11B
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               3 | Bob Johnson | 789 Maple St | 12C
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               (3 rows)

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 scode  | subject_name 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ---------+--------------
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  Math101 | Mathematics
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   Sci201  | Science
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Eng301  | English
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    (3 rows)

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     roll_no |  scode  | marks_scored 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ---------+---------+--------------
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            1 | Math101 |           90
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   1 | Sci201  |           85
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          2 | Math101 |           88
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 2 | Eng301  |           95
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        3 | Sci201  |           92
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        (5 rows)

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        CREATE FUNCTION
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        CREATE FUNCTION
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        CREATE FUNCTION

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        psql:commands.sql:134: ERROR:  column reference "roll_no" is ambiguous
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        LINE 1: SELECT * FROM Student WHERE roll_no = roll_num
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ^
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            DETAIL:  It could refer to either a PL/pgSQL variable or a table column.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            QUERY:  SELECT * FROM Student
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
)
)
)